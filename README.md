# 6. Key-Value Database

12장 채팅 시스템 설계에 대한 구현 과제입니다.  
[Notion 정리: 6장 키-값 저장소](https://puffy-daisy-806.notion.site/12-f20f8aed68e249bcaab1418ccdce3850?pvs=4)  
담당자: 박상엽(park-sy)  

|Week|Date|Desc|
|------|---|---|
|1주차|24.07.23~|내용 정리 및 설계|
|2주차|24.08.17~|아키텍쳐 설계 및 기본 채팅 기능 구현|
|3주차|24.09.07~|그룹 채팅 기능 및 접속 상태 확인 기능 구현|
|4주차|24.09.21~|로그인/회원가입, 친구추가, 채팅 만들기 기능 구현|


### 개요
해당 프로젝트, 채팅 시스템은 대규모 사용자의 채팅을 위한 분산 시스템 설계 및 구현을 목표로한다.  
기본적인 개인 채팅, 그룹 채팅을 지원하며, 사용자 회원가입, 로그인, 친구 관리, 웹소켓 채팅 서버 찾기 등의 기능을 지원한다.


### 상세 설계  
![image](https://github.com/user-attachments/assets/e9e76503-3934-42e0-ab5a-91931731ebf3)

- 채팅을 담당하는 서버는 클라이언트와 웹소켓을 통해 통신하며, 사용량에 따라 scale-out 할 수 있는 구조를 가진다.
- 메시지는 MongoDB에 저장하며 Kafka를 통해 사용자에게 메시지를 전달하며, 전달 받는 사용자가 채팅 서버와 연결된 경우에는 Kafka를 통해 메시지를 전달한다.
- 메시지의 ID는 snowflake를 통해 생성하여, ID 정렬만으로 전달된 메시지를 정렬할 수 있도록 구성되어 있다.
- 사용자는 HTTP를 통해 회원가입/로그인을 진행하고, 접속 시에 연결할 서버의 정보를 요청하여 전달받는다.
- 사용자의 웹소켓 연결 상태를 확인하기 위해서 서버로 5초마다 Hearbeat를 보내며, 30초 이상 Heartbeat가 전달되지 않은 경우에는 연결이 끊긴 것으로 간주한다.
